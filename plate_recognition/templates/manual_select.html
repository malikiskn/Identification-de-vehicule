<!DOCTYPE html>
<html>
<head>
    <title>Sélection manuelle</title>
    <style>
        #image-container { position: relative; display: inline-block; }
        #selection-box {
            position: absolute;
            border: 2px dashed red;
            display: none;
        }
    </style>
</head>
<body>
    <h2>Encadrez la plaque avec votre souris</h2>
    
    <div id="image-container">
        <img id="target-image" src="{{ url_for('static', filename='exports/' + image_path) }}" style="max-width: 80%;">
        <div id="selection-box"></div>
    </div>

    <form action="/submit_selection" method="POST">
        <input type="hidden" name="x" id="x">
        <input type="hidden" name="y" id="y">
        <input type="hidden" name="width" id="width">
        <input type="hidden" name="height" id="height">
        <input type="hidden" name="image_path" value="{{ image_path }}">
        <button type="submit" class="btn btn-primary">Valider la sélection</button>
    </form>

    <script>
        let startX, startY;
        const box = document.getElementById('selection-box');
        const img = document.getElementById('target-image');

        img.addEventListener('mousedown', (e) => {
            const rect = img.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            box.style.left = startX + 'px';
            box.style.top = startY + 'px';
            box.style.width = '0px';
            box.style.height = '0px';
            box.style.display = 'block';
        });

        window.addEventListener('mousemove', (e) => {
            if (!startX) return;
            
            const rect = img.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            box.style.width = (currentX - startX) + 'px';
            box.style.height = (currentY - startY) + 'px';
        });

        window.addEventListener('mouseup', () => {
            if (!startX) return;
            
            document.getElementById('x').value = startX;
            document.getElementById('y').value = startY;
            document.getElementById('width').value = parseInt(box.style.width);
            document.getElementById('height').value = parseInt(box.style.height);
            
            startX = null;
        });
    </script>
</body>
</html>